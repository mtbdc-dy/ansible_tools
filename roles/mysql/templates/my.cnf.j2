# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html
[mysql]
port				            = {{ mysql_port }}
socket				            = {{ mysql_running_info }}/mysql.sock

# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
# These are commonly set, remove the # and set as required.

[mysqld]
#当忘记root密码时，开启该选项
#skip-grant-tables
user							= {{ mysql_user }}
basedir							= {{ mysql_install_dir }}
datadir							= {{ mysql_data_dir }}
port							= {{ mysql_port }}
pid-file						= {{ mysql_running_info }}/mysql.pid
socket							= {{ mysql_running_info }}/mysql.sock

# 超时时间设置
connect_timeout                 = 60
wait_timeout                    = 1814400
interactive_timeout             = 120

# # SAFETY #
read_rnd_buffer_size 	       = 16M
max-allowed-packet             = 64M
max-connect-errors             = 1000000
skip-name-resolve
sql_mode                       = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION

sysdate-is-now                 = 1
federated

# # BINARY LOGGING #
log-bin                        = {{ mysql_logs_dir }}/mysql-bin.log
expire-logs-days               = 15
sync-binlog                    = 1

server-id                     = {{ ansible_default_ipv4.address | regex_replace('[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.','') }}
#log-slave-updates             = 1
#binlog-do-db                  = 
#binlog-do-db                  = 
#binlog-ignore-db              = mysql
#binlog_format                 = mixed
#slave_skip_errors             = 1062

tmp-table-size                 = 64M
max-heap-table-size            = 64M
query-cache-type               = 0
query-cache-size               = 0
max-connections                = 2000
thread-cache-size              = 50
open-files-limit               = 65535
table-definition-cache         = 1024
table-open-cache               = 128

# INNODB #
innodb-flush-method            = O_DIRECT
innodb-log-files-in-group      = 2
innodb-log-file-size           = 128M
innodb-flush-log-at-trx-commit = 1
innodb_support_xa              = 1
innodb-file-per-table          = 1
innodb-buffer-pool-size        = 2G
innodb_lock_wait_timeout       = 120

# LOGGING #
log-error                      = {{ mysql_logs_dir }}/mysql-error.log
slow-query-log-file            = {{ mysql_logs_dir }}/mysql-slow.log
log-queries-not-using-indexes  = 1
long_query_time		           = 1000
slow-query-log                 = 0