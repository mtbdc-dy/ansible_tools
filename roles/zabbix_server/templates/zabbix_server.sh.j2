#!/bin/sh 
# chkconfig:  2345 15 95

# description: zabbix_server \

# Source function library. 
if [ -f /etc/rc.d/init.d/functions ]
then
    . /etc/rc.d/init.d/functions  
fi

# Source networking configuration. 
if [ -f /etc/sysconfig/network ]
then
    . /etc/sysconfig/network  
fi

# Check that networking is up. 
[ "$NETWORKING" = "no" ] && exit 0  

zabbix="{{ zabbix_install_dir }}/sbin/zabbix_server" 
prog=$(basename ${zabbix})  

lockfile=/var/lock/subsys/zabbix_server
pidfile={{ zabbix_logs_dir }}/zabbix_agentd.pid

start()
{ 
    [ -x ${zabbix} ] || exit 5  
    echo -n $"Starting $prog: "  
    daemon ${zabbix}
    retval=$?  
    echo  
    [ $retval -eq 0 ] && touch $lockfile  
    return $retval  
}  

stop()
{ 
    echo -n $"Stopping $prog: "  
    killproc $prog -QUIT  
    retval=$?  
    echo  
    [ $retval -eq 0 ] && rm -f $lockfile  
    return $retval  
}  

restart()
{ 
    configtest || return $?  
    stop  
    start  
}  

reload()
{ 
    configtest || return $?  
    echo -n $"Reloading $prog: "  
    killproc ${zabbix} -HUP  
    RETVAL=$?  
    echo  
}  

force_reload()
{ 
    restart  
}  

configtest()
{ 
  ${zabbix} -t
}  

rh_status()
{ 
    status $prog  
}  

rh_status_q()
{ 
    rh_status >/dev/null 2>&1  
}  

case "$1" in 
    start)  
        rh_status_q && exit 0  
        $1  
        ;;  
    stop)  
        rh_status_q || exit 0  
        $1  
        ;;  
    restart|configtest)  
        $1  
        ;;  
    reload)  
        rh_status_q || exit 7  
        $1  
        ;;  
    status)  
        rh_status  
        ;;  
    *)  
        echo $"Usage: $0 {start|stop|status|restart|reload|configtest}"  
        exit 2  
esac